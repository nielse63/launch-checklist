"use strict";var path=require("path"),fs=require("fs"),open=require("open"),cwd=process.cwd(),envFile=path.resolve(cwd,".env");require("dotenv").config({path:envFile,silent:!0});var docroot=process.env.WP_ROOT;docroot||(docroot=path.resolve(cwd,"test","sample"));var checklist=require(cwd)({docroot:docroot}),template=path.resolve(__dirname,"index.mustache"),indexFile=template.replace(".mustache",".html"),dataFile=template.replace("index.mustache","data.json");checklist.on("tests:complete",function(e){var t={suites:[],siteurl:"",blogname:""};for(var s in e)if(e.hasOwnProperty(s)){var r=e[s],i={name:s,slug:r.slug,index:r.index,description:r.description,results:[]};for(var a in r._tests)if(r._tests.hasOwnProperty(a)){var o=r._tests[a];i.results.push({name:o.name,passed:o.passed,tests:o.hasOwnProperty("format")?o.format():o.results})}if(t.suites.push(i),"Site Info"===s){var n=Object.keys(r.tests),l=r.tests[n[0]].results.site;t.siteurl=l.siteurl,t.blogname=l.blogname}}var c=JSON.stringify(t);fs.writeFile(dataFile,c),fs.readFile(template,"utf8",function(e,t){if(e)throw e;t=t.replace("{{{json}}}",c),fs.writeFileSync(indexFile,t),open(indexFile)})}),checklist.run();